{% extends 'base.html.twig' %}

{% block title %}Pitchee - Cards likées{% endblock %}

{% block body %}
<div id="loader"></div>
<div class="container">
    <div class="header">
        <div class="profile-picture">
            {% if app.user.getImageFilename() != null %}
                <img src="{{ asset('uploads/' ~ app.user.getImageFilename()) }}" alt="profile-picture">
            {% else %}
                <img src="{{ asset('images/user/default-user-image.png') }}" alt="profile-picture">
            {% endif %}
        </div>
        <div class="header-title">
            <div class="title-sm">Hey {{ app.user.getFirstName() }},</div>
            <div class="title-lg">Tes cards likées</div>
        </div>
        <div class="header-options">
            <div class="header-button">
                <a href="{{ path('card_new') }}">Nouvelldde card</a>
            </div>
        </div>
    </div>

    {% if(likedCards is not null) %}
        <div class="grid">
            {% for card in likedCards %}
                <div class="grid-item">
                    <div class="block">
                        <div class="block-title">
                            <h1>{{ card.title }}</h1>
                            {% if is_granted('edit', card) %}
                                <a href="{{ path('card_edit', {'id': card.id}) }}" class="edit-card block-icon"><i class="fas fa-pen"></i></a>
                            {% endif %}
                            <a href="#" class="add-list-card show-card block-icon" style="right:30px">
                                <input type="hidden" class="card-id" value="{{ card.id }}">
                                <i class="fas fa-folder-plus"></i>
                            </a>
                            <a href="{{ path('card_show', {'id': card.id}) }}" class="show-card block-icon"><i class="fas fa-comment-medical"></i></a>
                        </div>
                        <div class="block-content card-show">
                            <div class="block-image">
                                {% if card.type == "video" or card.type == "musique" %}
                                    <div class="video-responsive">
                                        <iframe src="https://www.youtube.com/embed/{{ card.content[card.content|length-11:card.content|length] }}"  allow="fullscreen;"></iframe>
                                    </div>
                                {% else %}
                                    <img src="{{ card.content }}" alt="{{ card.title }}">
                                {% endif %}
                            </div>
                        </div>
                        <div class="block-list">
                            <button class="cancel-list">Annuler</button>
                            <button class="save-list">Sauvegarder</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div>Pas de cards. <a href="{{ path('card_new') }}">Tu veux en créer une ?</a></div>
    {% endif %}
</div>
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready(function() {
            setTimeout(function(){
                $('#loader').fadeOut(800);
            }, 1000);
        });
    </script>
    <script>
        $('.grid').masonry({
            // set itemSelector so .grid-sizer is not used in layout
            itemSelector: '.grid-item',
            // use element for option
            percentPosition: true,
            gutter: 10
        })

        $(document).on('click', '.add-list-card', function(e){
            e.preventDefault();
            cardId = $(this).children('.card-id').val();
            console.log(cardId)
            elem = $(this)

            $.ajax({
                url: '/card_list/'+cardId,
                success: function(response){
                    console.log(response);
                    console.log($(this).parent());
                    old = elem.parent().parent().children('.block-list').html();
                    console.log(old)
                    elem.parent().parent().children('.block-list').html(response+old);
                },
                error: function(res){
                    console.log(res);
                }
            })
        })

        $(document).on('click', '.save-list', function(){
            console.log('oui')
            select = $(this).parent().children('.list-selected option:selected');
            console.log(select);

            $.ajax({
                url: '/card_list/1/save',
                data: {'selected': select.text()},
                success: function(response){
                    console.log(response)
                }
            })
        })

        $(document).on('click', '.cancel-list', function(){
            $(this).parent().remove();
        })
    </script>
{% endblock %}
